# tasks/main.yml

- name: Remove conflicting packages
  apt:
    name: containerd
    state: absent
  ignore_errors: yes

- name: Install system packages
  apt:
    name:
      - docker.io
      - python3-pip
    state: present
    update_cache: yes

- name: Install docker-compose using pip
  pip:
    name: docker-compose
    state: present

- name: Start Docker service
  service:
    name: docker
    state: started
    enabled: yes

- name: Clone the repository
  git:
    repo: "{{ git_repository }}"
    dest: "{{ deployment_path }}"
    version: "{{ git_branch }}"
    force: yes

- name: Run docker-compose
  community.docker.docker_compose:
    project_src: "{{ deployment_path }}"
    build: yes
    state: present
